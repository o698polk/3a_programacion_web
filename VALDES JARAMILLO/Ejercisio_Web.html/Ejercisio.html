<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulario de Registro</title>
  <style>
    /* Estilos básicos: legibles y centrados */
    :root {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      font-size: 16px;
    }
    body {
      margin: 0;
      padding: 1.5rem;
      display: flex;
      justify-content: center;
      background: #f7f7f9;
    }
    .container {
      width: 100%;
      max-width: 680px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      padding: 1.5rem;
    }
    header, footer { text-align: center; margin-bottom: 1rem; }
    nav a { margin: 0 0.5rem; text-decoration: none; color: #0b66c3; }
    form > div { margin-bottom: 0.9rem; display: grid; gap: 0.35rem; }
    label { font-weight: 600; }
    input[type="text"],
    input[type="email"],
    input[type="number"],
    input[type="password"],
    select {
      padding: 0.6rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }
    .inline { display:flex; align-items:center; gap:0.5rem; }
    .error {
      color: #b00020;
      font-size: 0.9rem;
      display: none;
    }
    .error[aria-hidden="false"] { display: block; }
    button[type="submit"] {
      padding: 0.7rem 1rem;
      border: none;
      border-radius: 8px;
      background: #0b66c3;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    small {
      color: #555;
    }
  </style>
</head>
<body>
  <div class="container" role="region" aria-labelledby="titulo">
    <header>
      <h1 id="titulo">Registro de Usuario</h1>
      <nav aria-label="Navegación principal">
        <a href="#inicio">Inicio</a> |
        <a href="#contacto">Contacto</a>
      </nav>
    </header>

    <main>
      <section aria-labelledby="form-title">
        <h2 id="form-title">Complete sus datos</h2>

        <!-- novalidate está ausente para usar validación nativa + mensajes personalizados -->
        <form id="registroForm" action="procesar.php" method="POST" novalidate>
          <!-- Nombre -->
          <div>
            <label for="nombre">Nombre completo</label>
            <input
              type="text"
              id="nombre"
              name="nombre"
              required
              placeholder="Juan Pérez"
              aria-describedby="nombreHelp nombreError"
              pattern="^[A-Za-zÁÉÍÓÚÑÜáéíóúñü\s]{2,60}$"
              title="Ingrese sólo letras y espacios (2-60 caracteres)."
            />
            <small id="nombreHelp">Sólo letras y espacios. Mín 2 caracteres.</small>
            <div id="nombreError" class="error" aria-hidden="true"></div>
          </div>

          <!-- Email -->
          <div>
            <label for="email">Correo electrónico</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              placeholder="usuario@ejemplo.com"
              aria-describedby="emailError"
            />
            <div id="emailError" class="error" aria-hidden="true"></div>
          </div>

          <!-- Edad -->
          <div>
            <label for="edad">Edad</label>
            <input
              type="number"
              id="edad"
              name="edad"
              required
              min="18"
              max="100"
              aria-describedby="edadError"
            />
            <small>Debe ser mayor de 18 años.</small>
            <div id="edadError" class="error" aria-hidden="true"></div>
          </div>

          <!-- Género -->
          <div>
            <label for="genero">Género</label>
            <select id="genero" name="genero" required aria-describedby="generoError">
              <option value="">Seleccione...</option>
              <option value="masculino">Masculino</option>
              <option value="femenino">Femenino</option>
              <option value="otro">Otro</option>
              <option value="nopreferir">Prefiero no decir</option>
            </select>
            <div id="generoError" class="error" aria-hidden="true"></div>
          </div>

          <!-- Contraseña -->
          <div>
            <label for="password">Contraseña</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              minlength="8"
              aria-describedby="passwordHelp passwordError"
              title="Mínimo 8 caracteres."
            />
            <small id="passwordHelp">Mínimo 8 caracteres.</small>
            <div id="passwordError" class="error" aria-hidden="true"></div>
          </div>

          <!-- Confirmar contraseña -->
          <div>
            <label for="password2">Confirmar contraseña</label>
            <input
              type="password"
              id="password2"
              name="password2"
              required
              aria-describedby="password2Error"
            />
            <div id="password2Error" class="error" aria-hidden="true"></div>
          </div>

          <!-- Términos -->
          <div class="inline">
            <label>
              <input type="checkbox" id="terminos" name="terminos" required aria-describedby="terminosError" />
              Acepto los términos y condiciones
            </label>
            <div id="terminosError" class="error" aria-hidden="true"></div>
          </div>

          <div>
            <button type="submit">Registrarse</button>
          </div>
        </form>
      </section>
    </main>

    <footer>
      <p>© 2024 Mi Sitio Web. Todos los derechos reservados.</p>
    </footer>
  </div>

  <script>
    // Mensajes de error personalizados con Constraint Validation API
    (function () {
      const form = document.getElementById('registroForm');

      const fields = {
        nombre: {
          el: document.getElementById('nombre'),
          errEl: document.getElementById('nombreError'),
          messages: {
            valueMissing: 'Por favor ingrese su nombre.',
            patternMismatch: 'Nombre inválido. Solo letras y espacios (2-60).',
            tooShort: 'Nombre muy corto.'
          }
        },
        email: {
          el: document.getElementById('email'),
          errEl: document.getElementById('emailError'),
          messages: {
            valueMissing: 'Por favor ingrese su correo.',
            typeMismatch: 'Ingrese un correo válido.'
          }
        },
        edad: {
          el: document.getElementById('edad'),
          errEl: document.getElementById('edadError'),
          messages: {
            valueMissing: 'Ingrese su edad.',
            rangeUnderflow: 'La edad mínima es 18.',
            rangeOverflow: 'La edad máxima permitida es 100.'
          }
        },
        genero: {
          el: document.getElementById('genero'),
          errEl: document.getElementById('generoError'),
          messages: {
            valueMissing: 'Seleccione una opción.'
          }
        },
        password: {
          el: document.getElementById('password'),
          errEl: document.getElementById('passwordError'),
          messages: {
            valueMissing: 'Ingrese una contraseña.',
            tooShort: 'La contraseña debe tener al menos 8 caracteres.'
          }
        },
        password2: {
          el: document.getElementById('password2'),
          errEl: document.getElementById('password2Error'),
          messages: {
            valueMissing: 'Confirme su contraseña.',
            mismatch: 'Las contraseñas no coinciden.'
          }
        },
        terminos: {
          el: document.getElementById('terminos'),
          errEl: document.getElementById('terminosError'),
          messages: {
            valueMissing: 'Debe aceptar los términos.'
          }
        }
      };

      function showError(field) {
        const el = field.el;
        const errEl = field.errEl;
        let message = '';
        if (el.validity.valueMissing) {
          message = field.messages.valueMissing || 'Campo requerido.';
        } else if (el.validity.typeMismatch) {
          message = field.messages.typeMismatch || 'Formato inválido.';
        } else if (el.validity.patternMismatch) {
          message = field.messages.patternMismatch || 'Formato inválido.';
        } else if (el.validity.rangeUnderflow) {
          message = field.messages.rangeUnderflow || 'Valor demasiado pequeño.';
        } else if (el.validity.rangeOverflow) {
          message = field.messages.rangeOverflow || 'Valor demasiado grande.';
        } else if (el.validity.tooShort) {
          message = field.messages.tooShort || 'Texto demasiado corto.';
        } else {
          message = '';
        }

        // Check password match separately
        if (el.id === 'password2' && document.getElementById('password').value !== el.value) {
          message = field.messages.mismatch;
        }

        if (message) {
          errEl.textContent = message;
          errEl.setAttribute('aria-hidden', 'false');
        } else {
          errEl.textContent = '';
          errEl.setAttribute('aria-hidden', 'true');
        }
      }

      // attach input/blur listeners
      Object.values(fields).forEach(f => {
        if (!f || !f.el) return;
        f.el.addEventListener('input', () => showError(f));
        f.el.addEventListener('blur', () => showError(f));
      });

      form.addEventListener('submit', function (e) {
        // Validate all fields
        Object.values(fields).forEach(showError);

        // Re-check password match
        const pwd = document.getElementById('password').value;
        const pwd2 = document.getElementById('password2').value;
        if (pwd && pwd2 && pwd !== pwd2) {
          fields.password2.errEl.textContent = fields.password2.messages.mismatch;
          fields.password2.errEl.setAttribute('aria-hidden', 'false');
          e.preventDefault();
          return;
        }

        // If form is invalid, prevent submit
        if (!form.checkValidity()) {
          e.preventDefault();
          // focus first invalid control for usability
          const firstInvalid = form.querySelector(':invalid');
          if (firstInvalid) firstInvalid.focus();
        }
      });
    })();
  </script>
</body>
</html>

